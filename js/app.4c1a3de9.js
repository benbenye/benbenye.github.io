webpackJsonp([1],{0:function(t,e,n){t.exports=n("NHnr")},"1EGf":function(t,e){},DhF9:function(t,e){},G3BA:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("/5sW"),a=(n("mJx5"),{token:"",userType:"",path:""}),s=n("mtWM"),i=n.n(s),c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:localStorage.getItem("github-token"),e={Accept:"application/vnd.github.black-panther-preview+json application/vnd.github.symmetra-preview+json","Content-type":"application/json"};return t&&(e.Authorization="token ".concat(t.split(" ")[1])),i.a.create({baseURL:"https://api.github.com",headers:e})},r={repoPath:"/repos/benbenye/benbenye.github.io",commentPath:"/repos/benbenye/test-issue",isUseIssue:!0},u=(c().get("".concat(r.repoPath)),function(){var t={testToken:function(t){var e=this;this.testAdminToken().then(function(n){return"ok"===n?(e.setToken("admin",t),"ok."):(alert("sorry, you haven't access to this blog"),e.testGuestToken())}).then(function(){e.setToken("guest",t),alert("ok.")}).catch(function(){alert("Please rewrite your token.")})},setToken:function(t,e){a.token=this.token,localStorage.setItem("github-token","".concat(t," ").concat(e))},testGuestToken:function(){c().post("".concat(r.commentPath,"/issues/1/comments"),{body:"test for guest token."}).then(function(){return"ok"}).catch(function(){return!1})},testAdminToken:function(){var t=this;return c().get("".concat(r.repoPath,"/contents/test-token")).then(function(e){return c(t.token).put("".concat(r.repoPath,"/contents/test-token"),{message:"test token",sha:e.data.sha,content:""})}).then(function(){return"ok"}).catch(function(){return!1})}};return t.testToken}),l={name:"App",data:function(){return{token:a.token,Data:a}},created:function(){a.path=this.$route.path},mounted:function(){localStorage.getItem("github-token")&&(a.token=this.token=localStorage.getItem("github-token").split(" ")[1],a.userType=localStorage.getItem("github-token").split(" ")[0],u())},methods:{login:u}},m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("nav",{class:{active:"/"===t.Data.path}},[n("li",[n("router-link",{attrs:{to:"/"}},[t._v("首页")])],1),n("li",[n("router-link",{attrs:{to:"/about"}},[t._v("关于")])],1),n("li",[n("router-link",{attrs:{to:"/contents"}},[t._v("归档")])],1)]),t.Data.token?t._e():n("div",{staticClass:"token"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.token,expression:"token"}],attrs:{type:"text",placeholder:"请填写您的 github token"},domProps:{value:t.token},on:{input:function(e){e.target.composing||(t.token=e.target.value)}}}),n("button",{staticClass:"btn",on:{click:function(e){t.login(t.token)}}},[t._v("登录")])]),t.Data.token&&"/"===t.Data.path?n("router-link",{staticClass:"new-btn",attrs:{to:"/new-blog"}},[t._v("新建博客")]):t._e(),n("router-view")],1)},p=[],d=n("XyMi");function h(t){n("G3BA")}var f=!1,v=h,g=null,b=null,C=Object(d["a"])(l,m,p,f,v,g,b),k=C.exports,_=n("/ocq"),y=(n("MfeA"),n("y9m4"),n("fx22"),n("EFqf")),P=n.n(y),w={name:"home",components:{},data:function(){return{files:[],filesContent:[],filesTime:[],Data:a}},created:function(){a.path=this.$route.path},mounted:function(){var t=this;c().get("".concat(r.repoPath,"/contents")).then(function(e){return t.files=e.data,Promise.all(t.files.map(function(e){return t.getFileContents(e.path)}))}).then(function(e){return t.filesContent=e.map(function(t){var e=decodeURIComponent(escape(atob(t.data.content))),n=!!e.match(/([^]*)<!--more-->/m);return P()(n?e.match(/([^]*)<!--more-->/m)[1]:e,{sanitize:!0})}),Promise.all(t.files.map(function(e){return t.getFileTime(e.path.match(/\[(\d*)\]/)?e.path.match(/\[(\d*)\]/)[1]:null)}))}).then(function(e){t.filesTime=e,c().get("/user").then(function(t){return console.log(t)})})},filters:{filterTime:function(t){var e=new Date(t);return"".concat(e.getFullYear(),"年").concat(e.getMonth()+1,"月").concat(e.getDay(),"日 ").concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())}},methods:{getFileContents:function(t){return c().get("".concat(r.repoPath,"/contents/").concat(t))},getFileTime:function(t){return t?c().get("".concat(r.commentPath,"/issues/").concat(t)):null},cut:function(t){c().delete("".concat(r.repoPath,"/contents/").concat(t.path,"?message=delete&sha=").concat(t.sha)).then(function(){alert("delete success")}).catch(function(){})}}},T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},t._l(t.files,function(e,o){return"file"===e.type&&"test-token"!==e.path?n("div",{key:o,staticClass:"post animated fadeInDown"},[n("div",{staticClass:"post-title"},[n("h3",[n("router-link",{attrs:{to:{name:"blog",params:{path:e.path}}}},[t._v(t._s(e.name))]),"admin"==t.Data.userType?[n("router-link",{attrs:{to:{name:"edit",params:{path:e.path}}}},[t._v(" [修改]")]),n("span",{staticClass:"delete",on:{click:function(n){t.cut(e)}}},[t._v("[删除]")])]:t._e()],2)]),n("div",{staticClass:"post-content",domProps:{innerHTML:t._s(t.filesContent[o])}}),t.filesTime[o]?n("div",{staticClass:"post-footer"},[n("div",{staticClass:"meta"},[n("div",{staticClass:"info"},[n("i",{staticClass:"fa fa-sun-o"}),n("span",{staticClass:"date"},[t._v(t._s(t._f("filterTime")(t.filesTime[o].data.created_at)))]),n("i",{staticClass:"fa fa-tag"})])])]):t._e()]):t._e()}))},I=[];function x(t){n("oOl1")}var M=!1,$=x,E=null,j=null,q=Object(d["a"])(w,T,I,M,$,E,j),U=q.exports,D=(n("VjuZ"),n("M4fF")),O=n.n(D),A={name:"MarkedEditor",props:{editor:{type:Object,required:!0},type:{type:String,required:!0}},data:function(){return{input:"edit"===this.type&&decodeURIComponent(escape(atob(this.editor.content))),createInput:"",title:this.filterUniqueId("edit"===this.type?this.editor.path:""),commitMes:"commit",uniqueTitle:""}},computed:{compiledMarkdown:function(){return"create"===this.type?"":P()(this.input,{sanitize:!0})}},methods:{updateContent:O.a.debounce(function(t){this.input=t.target.value},300),updateCreateContent:O.a.debounce(function(t){this.createInput=t.target.value},300),update:function(){var t=this;this.editor.path==="[".concat(this.editor.path.match(/\[(\d*)\]/)[1],"]").concat(this.title)?c().put("".concat(r.repoPath,"/contents/").concat(this.editor.path),{message:this.commitMes,sha:this.editor.sha,content:btoa(unescape(encodeURIComponent(this.input)))}):this.create().then(function(){c().delete("".concat(r.repoPath,"/contents/").concat(t.editor.path,"?message=delete&sha=").concat(t.editor.sha))})},create:function(){var t=this;if(r.isUseIssue)return"edit"===this.type?(this.uniqueTitle="[".concat(this.editor.path.match(/\[(\d*)\]/)[1],"]").concat(this.title),c().put("".concat(r.repoPath,"/contents/").concat(this.uniqueTitle),{message:this.commitMes,content:btoa(unescape(encodeURIComponent(this.input)))}).then().catch(function(){})):c().post("".concat(r.commentPath,"/issues"),{title:this.title,body:"https://benbenye.github.io"}).then(function(e){return t.uniqueTitle="[".concat(e.data.number,"]").concat(t.title),c().put("".concat(r.repoPath,"/contents/").concat(t.uniqueTitle),{message:t.commitMes,content:btoa(unescape(encodeURIComponent(t.createInput)))})}).catch(function(){});var e="";return e="edit"===this.type?"[".concat(this.editor.path.match(/\[(\d*)\]/)[1],"]").concat(this.title):this.title,c().put("".concat(r.repoPath,"/contents/").concat(e),{message:this.commitMes,content:btoa(unescape(encodeURIComponent(this.createInput)))}).then().catch(function(){})},filterUniqueId:function(t){return t.match(/\[\d*\]/)?t.replace(/(\[\d*\])/,""):t}}},F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"editor"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"header",attrs:{type:"text",placeholder:"文章标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),"edit"===t.type?n("button",{staticClass:"update commit",on:{click:t.update}},[t._v("更新")]):n("button",{staticClass:"create commit",on:{click:t.create}},[t._v("新建")]),"edit"===t.type?n("div",{staticClass:"main"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"editor-input",domProps:{value:t.input},on:{input:[function(e){e.target.composing||(t.input=e.target.value)},t.updateContent]}}),n("div",{staticClass:"content-preview",domProps:{innerHTML:t._s(t.compiledMarkdown)}})]):n("div",{staticClass:"main"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.createInput,expression:"createInput"}],staticClass:"editor-input",domProps:{value:t.createInput},on:{input:[function(e){e.target.composing||(t.createInput=e.target.value)},t.updateCreateContent]}}),n("div",{staticClass:"content-preview",domProps:{innerHTML:t._s(t.compiledMarkdown)}})])])},N=[];function R(t){n("1EGf")}var G=!1,H=R,S=null,B=null,L=Object(d["a"])(A,F,N,G,H,S,B),z=L.exports,V={components:{MarkedEditor:z},data:function(){return{contents:null,type:"edit"}},created:function(){a.path=this.$route.path},mounted:function(){var t=this;c().get("".concat(r.repoPath,"/contents/").concat(this.$route.params.path)).then(function(e){e.status<=299&&(t.contents=e.data)})}},Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"editor"},[t.contents?n("marked-editor",{attrs:{editor:t.contents,type:t.type},on:{"update:editor":function(e){t.contents=e}}}):t._e()],1)},J=[],W=!1,Y=null,X=null,K=null,Q=Object(d["a"])(V,Z,J,W,Y,X,K),tt=Q.exports,et={name:"comment",components:{},props:{number:{type:Number,required:!0}},data:function(){return{comments:[],comment:""}},mounted:function(){var t=this;c().get("".concat(r.commentPath,"/issues/").concat(this.number,"/comments")).then(function(e){t.comments=e.data})},methods:{commit:function(){c().post("".concat(r.commentPath,"/issues/").concat(this.number,"/comments"),{body:this.comment}).then(function(){alert("commit success"),window.location.reload()}).catch(function(){alert("Your token illegal")})}}},nt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment"},[n("div",{staticClass:"comment-title"},[t._v("评论")]),n("div",{staticClass:"comment-form"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"content-input",attrs:{placeholder:"说说你的看法"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}}),n("button",{staticClass:"submit-btn",on:{click:t.commit}},[t._v("提交")])]),n("div",{staticClass:"comment-list"},[n("ul",t._l(t.comments,function(e,o){return n("li",{key:o,staticClass:"item"},[n("div",{staticClass:"comment-content"},[n("div",{staticClass:"user-popover-box"},[n("a",{attrs:{href:e.user.html_url,target:" blank",rel:""}},[n("div",{staticClass:"avatar",style:"background-image: url("+e.user.avatar_url+");",attrs:{title:e.user.login}})])]),n("div",{staticClass:"content-box"},[n("div",{staticClass:"header"},[n("div",{staticClass:"user-info"},[n("div",{staticClass:"user-popover-box"},[n("a",{staticClass:"username",attrs:{href:e.user.html_url,target:"_blank",rel:""}},[t._v(t._s(e.user.login))])])])]),n("div",{staticClass:"content"},[n("span",{staticClass:"content-html"},[t._v(t._s(e.body))])]),n("div",{staticClass:"footer"},[t._m(0,!0),n("span",{staticClass:"date"},[t._v(t._s(e.created_at))])])])])])}))])])},ot=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"sub-comment-btn text-pointer"},[n("span",{staticClass:"title"},[t._v("评论")])])}];function at(t){n("V2gf")}var st=!1,it=at,ct="data-v-5642b934",rt=null,ut=Object(d["a"])(et,nt,ot,st,it,ct,rt),lt=ut.exports,mt={components:{Comment:lt},data:function(){return{contents:null,html:"",number:0}},created:function(){a.path=this.$route.path},mounted:function(){var t=this;c().get("".concat(r.repoPath,"/contents/").concat(this.$route.params.path)).then(function(e){if(t.contents=e.data,t.html=P()(decodeURIComponent(escape(atob(t.contents.content))),{sanitize:!0}),r.isUseIssue){var n=t.$route.params.path.match(/\[(\d*)\]/);t.number=n&&+n[1]}})}},pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blog"},[n("div",{staticClass:"post animated fadeInDown"},[n("div",{staticClass:"post-title"},[n("h3",[t._v(t._s(t.contents&&t.contents.path))])]),n("div",{staticClass:"post-content",domProps:{innerHTML:t._s(t.html)}}),t._m(0)]),t.number?n("comment",{attrs:{number:t.number}}):t._e()],1)},dt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"post-footer"},[n("div",{staticClass:"meta"},[n("div",{staticClass:"info"},[n("i",{staticClass:"fa fa-sun-o"}),n("span",{staticClass:"date"},[t._v("2016-12-26")]),n("i",{staticClass:"fa fa-tag"})])])])}];function ht(t){n("qZpB")}var ft=!1,vt=ht,gt=null,bt=null,Ct=Object(d["a"])(mt,pt,dt,ft,vt,gt,bt),kt=Ct.exports,_t={name:"new-blog",components:{MarkedEditor:z},data:function(){return{editor:{}}},created:function(){a.path=this.$route.path}},yt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"new"},[n("marked-editor",{attrs:{editor:t.editor,type:"create"}})],1)},Pt=[];function wt(t){n("DhF9")}var Tt=!1,It=wt,xt="data-v-4aae1189",Mt=null,$t=Object(d["a"])(_t,yt,Pt,Tt,It,xt,Mt),Et=$t.exports;o["a"].use(_["a"]);var jt=new _["a"]({mode:"history",routes:[{path:"/",name:"home",component:U},{path:"/edit/:path",name:"edit",component:tt},{path:"/blog/:path",name:"blog",component:kt},{path:"/new-blog",name:"new-blog",component:Et},{path:"/about",name:"about",component:Et},{path:"/contents",name:"contents",component:Et}]}),qt=n("ydGU");Object(qt["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}}),o["a"].config.productionTip=!1,new o["a"]({router:jt,render:function(t){return t(k)}}).$mount("#app")},V2gf:function(t,e){},oOl1:function(t,e){},qZpB:function(t,e){}},[0]);
//# sourceMappingURL=app.4c1a3de9.js.map